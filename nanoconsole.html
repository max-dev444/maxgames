<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NanoConsole</title>
<style>
body{background:#0b0b0b;color:#00ffcc;font-family:monospace}
#console{background:#000;border:2px solid #00ffcc;padding:10px;height:220px;overflow-y:auto}
#editor{width:100%;height:220px;background:#000;color:#00ffcc;border:2px solid #00ffcc}
input,button{background:#000;color:#00ffcc;border:1px solid #00ffcc;margin:4px}
#files button.active{background:#00ffcc;color:#000}
#help,#ops{display:none;background:#000;border:2px solid #00ffff;padding:10px}
</style>
</head>
<body>

<h1>ðŸ§  NanoConsole</h1>

<div id="console"></div>
<input id="cmd">
<button onclick="run()">Run</button>
<button onclick="clearConsole()">Clear</button>
<button onclick="toggle('help')">Help</button>
<button onclick="toggle('ops')">Variables & Operators</button>

<h3>Files</h3>
<div id="files"></div>
<button onclick="newFile()">New File</button>

<textarea id="editor"></textarea>
<button onclick="save()">Save</button>

<div id="help">
<h3>How NanoConsole Works</h3>
<p>You create functions in the editor using lines like: define add(x,y)=x+y. When you press Save, NanoConsole loads every function from all files so they can be used in the console.</p>
<p>You run a function by typing its name with values: add(5,10). Strings must be in quotes, numbers donâ€™t.</p>
<p>You can also store variables using: set hp = 100 or set name = "Max". Those values can be used inside functions.</p>
<p>You can use random, conditions, loops, and game helpers to build games, generators, or simulations.</p>
<p>Everything is saved automatically inside your browser.</p>
</div>

<div id="ops">
<h3>Tools</h3>
<p>
+ - * / % ** <br>
== != > < >= <= <br>
if(cond,a,b) loop(i,a,b,code)<br>
rand() rand(n) randInt(a,b) pick(a,b,c) <br>
upper(x) lower(x) length(x) repeat(x,n) reverse(x) <br>
rollDice() chance(x) randPos(n)
</p>
</div>

<script>
let files=JSON.parse(localStorage.nano_files||'{"main":""}');
let vars=JSON.parse(localStorage.nano_vars||"{}");
let logData=JSON.parse(localStorage.nano_log||"[]");
let current=localStorage.nano_current||"main";
let funcs={};

function saveAll(){
 localStorage.nano_files=JSON.stringify(files);
 localStorage.nano_vars=JSON.stringify(vars);
 localStorage.nano_log=JSON.stringify(logData);
 localStorage.nano_current=current;
}

function log(t){logData.push(t);saveAll();renderConsole();}
function renderConsole(){console.innerHTML=logData.join("<br>");console.scrollTop=console.scrollHeight;}

function renderFiles(){
 filesDiv.innerHTML="";
 for(let f in files){
  let b=document.createElement("button");b.textContent=f;
  if(f==current)b.classList.add("active");
  b.onclick=()=>switchFile(f);filesDiv.appendChild(b);
 }
}

function switchFile(f){files[current]=editor.value;current=f;editor.value=files[current];saveAll();renderFiles();}
function newFile(){let n="file"+(Object.keys(files).length+1);files[n]="";switchFile(n);}

function save(){files[current]=editor.value;saveAll();loadFunctions();log("Saved "+current);}

function loadFunctions(){
 funcs={};
 for(let f in files){
  files[f].split("\n").forEach(l=>{
   let m=l.match(/^(define|func|make|fn) (\w+)\(([\w,]*)\)\s*=\s*(.*)$/);
   if(m)funcs[m[2]]={p:m[3].split(",").filter(x=>x),b:m[4]};
  });
 }
}

function run(){
 let c=cmd.value.trim();cmd.value="";
 if(c.startsWith("set ")){
  let p=c.slice(4).split("=");
  vars[p[0].trim()]=eval(p[1]);
  saveAll();log("set "+p[0]);
  return;
 }
 let m=c.match(/^(\w+)\((.*)\)$/);
 if(!m||!funcs[m[1]]){log("Invalid");return;}
 let f=funcs[m[1]];
 let args=m[2].split(",").map(x=>eval(x));
 let body=f.b;
 f.p.forEach((p,i)=>body=body.replaceAll(p,args[i]));
 try{
  let result=eval(body);
  log(result);
 }catch(e){log("Error");}
}

function clearConsole(){logData=[];saveAll();renderConsole();}
function toggle(id){let e=document.getElementById(id);e.style.display=e.style.display=="none"?"block":"none";}

editor.value=files[current];
renderFiles();
renderConsole();
loadFunctions();
</script>
</body>
</html>
