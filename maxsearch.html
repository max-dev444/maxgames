<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MaxSearch</title>
<style>
  body { font-family: sans-serif; margin: 20px; background: #f0f0f0; }
  header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
  input[type=text] { flex: 1; padding: 8px; font-size: 16px; }
  button { padding: 8px 12px; font-size: 16px; cursor: pointer; }
  #results { background: #fff; padding: 15px; border-radius: 8px; min-height: 50px; }
  .result-item { margin-bottom: 10px; }
</style>
</head>
<body>

<header>
  <button onclick="goHome()">Home</button>
  <button onclick="goHub()">Back to Hub</button>
  <input type="text" id="searchInput" placeholder="Search...">
  <button id="searchBtn">Search</button>
</header>

<div id="results">Loading data… please wait.</div>

<script>
// --------------------------
// 1. DATA SECTION
// --------------------------
let data = new Map();
let isDataLoaded = false;

// Fetch your JSON from the live site
fetch("www.maxgames.org/data.json")
    .then(res => res.json())
    .then(obj => {
        data = new Map(Object.entries(obj));
        isDataLoaded = true;

        // Run initial search after data loads
        const query = getQuery();
        if (query) {
            document.getElementById("searchInput").value = query;
            showResult(query);
        } else {
            document.getElementById("results").textContent = "Type something to search!";
        }
    })
    .catch(err => {
        console.error("Failed to load data.json:", err);
        document.getElementById("results").textContent = "Failed to load data.json!";
    });

// --------------------------
// 2. BUTTON FUNCTIONS
// --------------------------
function goHome() {
    window.location.href = "maxsearch.html";
}
function goHub() {
    window.location.href = "index.html";
}

// --------------------------
// 3. HELPER FUNCTIONS
// --------------------------
function getQuery() {
    const params = new URLSearchParams(window.location.search);
    return params.get("search") || "";
}

function fuzzySearch(query) {
    if (!isDataLoaded) return [];
    const q = query.toLowerCase();
    const results = [];
    for (const [key, value] of data) {
        if (key.toLowerCase().includes(q)) results.push({ key, value });
    }
    return results;
}

function showResult(query) {
    const resultsDiv = document.getElementById("results");

    if (!isDataLoaded) {
        resultsDiv.innerHTML = "Loading data… please wait.";
        return;
    }

    const results = fuzzySearch(query);

    if (results.length > 0) {
        resultsDiv.innerHTML = results.map(r =>
            `<div class="result-item"><strong>${r.key}</strong>: ${r.value}</div>`
        ).join("");
    } else {
        resultsDiv.innerHTML = `You searched for "<strong>${query}</strong>" and it doesn't seem to have any results.`;
    }
}

// --------------------------
// 4. SEARCH BUTTON & ENTER KEY
// --------------------------
document.getElementById("searchBtn").addEventListener("click", () => {
    const input = document.getElementById("searchInput").value.trim();
    if (!input) return;
    const newURL = window.location.pathname + "?search=" + encodeURIComponent(input);
    history.pushState(null, "", newURL);
    showResult(input);
});

document.getElementById("searchInput").addEventListener("keydown", (e) => {
    if (e.key === "Enter") document.getElementById("searchBtn").click();
});
</script>

</body>
</html>
