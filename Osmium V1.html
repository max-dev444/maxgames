<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Osmium — tiny single-file note/snippet manager</title>
  <style>
    :root{--bg:#0f1724;--panel:#0b1220;--muted:#9aa4b2;--accent:#60a5fa;--accent2:#7c3aed;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial; background:linear-gradient(180deg,#071023 0%, #07172a 100%);color:#e6eef8}
    .app{max-width:980px;margin:28px auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;gap:16px}
    h1{margin:0;font-size:20px}
    .controls{display:flex;gap:8px;margin-left:auto;align-items:center}
    button{background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:white;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600}
    .grid{display:grid;grid-template-columns:360px 1fr;gap:16px;margin-top:18px}
    .panel{background:var(--panel);padding:14px;border-radius:10px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input[type='text'], textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;font-size:14px}
    textarea{min-height:120px;resize:vertical}
    .taglist{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .tag{background:rgba(255,255,255,0.04);padding:4px 8px;border-radius:999px;font-size:12px;color:var(--muted)}
    .note-row{padding:10px;border-radius:8px;display:flex;justify-content:space-between;gap:8px;align-items:flex-start;border:1px solid rgba(255,255,255,0.02);background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);margin-bottom:8px}
    .note-meta{font-size:13px}
    .note-title{font-weight:700}
    .preview{color:var(--muted);font-size:13px;margin-top:6px}
    .small{font-size:12px;color:var(--muted)}
    .search{display:flex;gap:8px}
    .toolbar{display:flex;gap:8px;margin-top:8px}
    .empty{color:var(--muted);text-align:center;padding:40px}
    .modal{position:fixed;inset:0;background:linear-gradient(180deg, rgba(2,6,23,0.6), rgba(2,6,23,0.8));display:flex;align-items:center;justify-content:center;padding:20px}
    .modal .panel{max-width:800px;width:100%}
    .flex{display:flex;gap:8px;align-items:center}
    .muted{color:var(--muted)}
    .note-actions{display:flex;gap:6px}
    input[type='file']{display:none}
    footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}
    @media(max-width:880px){.grid{grid-template-columns:1fr;}.controls{flex-wrap:wrap}}
  </style>
</head>
<body>
<div class="app" role="application" aria-label="Osmium note manager">
  <header>
    <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><rect width="24" height="24" rx="6" fill="#60a5fa"/><path d="M7 12h10M7 8h10M7 16h6" stroke="#071022" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
    <div>
      <h1>Osmium</h1>
      <div class="small muted">tiny single-file note &amp; snippet manager — localStorage</div>
    </div>
    <div class="controls">
      <div class="search">
        <input id="searchInput" type="text" placeholder="Search notes..." />
        <button id="searchBtn" class="ghost">Search</button>
      </div>
      <button id="newBtn">New Note</button>
      <button id="exportBtn" class="ghost">Export</button>
      <label class="ghost" id="importLabel" for="importFile" style="padding:8px 12px;border-radius:8px;cursor:pointer">Import</label>
      <input id="importFile" type="file" accept="application/json" />
    </div>
  </header>

  <div class="grid">
    <div class="panel" style="min-height:420px">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div class="small muted">Notes</div>
        <div class="small muted">Stored in localStorage &raquo; <code id="storageKey">osmiumDB</code></div>
      </div>
      <div id="list" style="margin-top:12px;max-height:560px;overflow:auto"></div>
      <div id="empty" class="empty" style="display:none">No notes yet — click <strong>New Note</strong> to create one.</div>
    </div>

    <div class="panel" id="editorPanel">
      <div id="editorHeader"><div class="small muted">Editor</div></div>
      <div style="margin-top:8px">
        <label for="title">Title</label>
        <input id="title" type="text" placeholder="Short descriptive title" />
        <label for="tags" style="margin-top:10px">Tags (comma separated)</label>
        <input id="tags" type="text" placeholder="tag1, tag2" />
        <label for="body" style="margin-top:10px">Body</label>
        <textarea id="body" placeholder="Write or paste your note / snippet here..."></textarea>
        <div class="toolbar">
          <button id="saveBtn">Save</button>
          <button id="clearBtn" class="ghost">Clear</button>
          <button id="copyBtn" class="ghost">Copy body</button>
          <div style="margin-left:auto" class="muted small">ID: <span id="currId">—</span></div>
        </div>
      </div>
    </div>
  </div>

  <footer>Tip: Osmium stores data locally only. Use Export to back up or transfer notes.</footer>
</div>

<!-- view modal -->
<div id="viewModal" class="modal" style="display:none" aria-hidden="true">
  <div class="panel">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div id="vTitle" class="note-title"></div>
        <div class="small muted" id="vMeta"></div>
      </div>
      <div class="note-actions">
        <button id="editBtn" class="ghost">Edit</button>
        <button id="deleteBtn" class="ghost">Delete</button>
        <button id="closeView" class="ghost">Close</button>
      </div>
    </div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0"/>
    <pre id="vBody" style="white-space:pre-wrap;background:transparent;border:none;padding:0;margin:0;font-family:inherit"></pre>
  </div>
</div>

<script>
(function(){
  'use strict';
  const STORAGE_KEY = 'osmiumDB';
  const defaultDB = { nextId: 1, notes: {} };

  // DOM
  const listEl = document.getElementById('list');
  const emptyEl = document.getElementById('empty');
  const titleInput = document.getElementById('title');
  const tagsInput = document.getElementById('tags');
  const bodyInput = document.getElementById('body');
  const saveBtn = document.getElementById('saveBtn');
  const clearBtn = document.getElementById('clearBtn');
  const newBtn = document.getElementById('newBtn');
  const currIdEl = document.getElementById('currId');
  const searchInput = document.getElementById('searchInput');
  const searchBtn = document.getElementById('searchBtn');
  const exportBtn = document.getElementById('exportBtn');
  const importFile = document.getElementById('importFile');
  const importLabel = document.getElementById('importLabel');
  const storageKeyEl = document.getElementById('storageKey');

  const viewModal = document.getElementById('viewModal');
  const vTitle = document.getElementById('vTitle');
  const vMeta = document.getElementById('vMeta');
  const vBody = document.getElementById('vBody');
  const editBtn = document.getElementById('editBtn');
  const deleteBtn = document.getElementById('deleteBtn');
  const closeView = document.getElementById('closeView');

  storageKeyEl.textContent = STORAGE_KEY;

  function readDB(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return JSON.parse(JSON.stringify(defaultDB));
      return JSON.parse(raw);
    }catch(e){
      console.error('Failed to read DB',e);
      return JSON.parse(JSON.stringify(defaultDB));
    }
  }
  function writeDB(db){
    localStorage.setItem(STORAGE_KEY, JSON.stringify(db));
  }

  function formatDate(iso){
    try{ return new Date(iso).toLocaleString(); }catch(e){return iso}
  }

  function renderList(filter){
    const db = readDB();
    const notes = Object.values(db.notes).sort((a,b)=>a.id-b.id);
    listEl.innerHTML = '';
    const hits = filter ? notes.filter(n=> (n.title+" "+n.body+" "+(n.tags||[]).join(' ')).toLowerCase().includes(filter.toLowerCase())) : notes;
    if(hits.length===0){ emptyEl.style.display='block'; return; } else { emptyEl.style.display='none'; }
    for(const n of hits){
      const row = document.createElement('div'); row.className='note-row';
      const left = document.createElement('div'); left.style.flex='1';
      const t = document.createElement('div'); t.className='note-title'; t.textContent = n.title || '(untitled)';
      const meta = document.createElement('div'); meta.className='note-meta small muted'; meta.textContent = `#${n.id} — ${formatDate(n.updated||n.created)}`;
      const preview = document.createElement('div'); preview.className='preview'; preview.textContent = (n.body||'').split('\n')[0];
      left.appendChild(t); left.appendChild(meta); left.appendChild(preview);
      const right = document.createElement('div'); right.style.display='flex'; right.style.flexDirection='column'; right.style.gap='6px';
      const tagsWrap = document.createElement('div'); tagsWrap.className='taglist'; (n.tags||[]).slice(0,5).forEach(tag=>{const el=document.createElement('div');el.className='tag';el.textContent=tag;tagsWrap.appendChild(el)});
      const actions = document.createElement('div'); actions.style.display='flex'; actions.style.gap='6px';
      const openBtn = document.createElement('button'); openBtn.className='ghost'; openBtn.textContent='Open'; openBtn.onclick=()=>openNote(n.id);
      const quickCopy = document.createElement('button'); quickCopy.className='ghost'; quickCopy.textContent='Copy'; quickCopy.onclick=()=>{navigator.clipboard.writeText(n.body||''); quickToast('copied');};
      actions.appendChild(openBtn); actions.appendChild(quickCopy);
      right.appendChild(tagsWrap); right.appendChild(actions);
      row.appendChild(left); row.appendChild(right);
      listEl.appendChild(row);
    }
  }

  function newNote(){
    currIdEl.textContent='—'; titleInput.value=''; tagsInput.value=''; bodyInput.value='';
    titleInput.focus();
  }

  function saveCurrent(){
    const db = readDB();
    const idText = currIdEl.textContent;
    if(idText==='—'){ // new note
      const id = db.nextId++;
      const note = makeNote(id);
      db.notes[id] = note;
      writeDB(db);
      currIdEl.textContent = id;
      quickToast('Saved new note');
    } else {
      const id = Number(idText);
      if(!db.notes[id]){ quickToast('Note not found — creating new'); const nid=db.nextId++; db.notes[nid]=makeNote(nid); db.nextId=nid+1; currIdEl.textContent=nid; writeDB(db); renderList(); return; }
      const note = makeNote(id);
      db.notes[id] = note;
      writeDB(db);
      quickToast('Saved');
    }
    renderList(searchInput.value.trim());
  }

  function makeNote(id){
    const now = new Date().toISOString();
    const tags = tagsInput.value.split(',').map(s=>s.trim()).filter(Boolean);
    return { id, title: titleInput.value.trim(), body: bodyInput.value, tags, created: now, updated: now };
  }

  function openNote(id){
    const db = readDB(); const n = db.notes[id]; if(!n) return quickToast('Note not found');
    vTitle.textContent = n.title || '(untitled)';
    vMeta.textContent = `#${n.id} • ${formatDate(n.created)} • ${n.tags && n.tags.length? 'tags: '+n.tags.join(', '):''}`;
    vBody.textContent = n.body || '';
    viewModal.style.display='flex'; viewModal.setAttribute('aria-hidden','false');
    // wire actions
    editBtn.onclick = ()=>{ viewModal.style.display='none'; currIdEl.textContent = n.id; titleInput.value=n.title; tagsInput.value=(n.tags||[]).join(', '); bodyInput.value=n.body; titleInput.focus(); };
    deleteBtn.onclick = ()=>{ if(confirm('Delete note #'+n.id+'?')){ deleteNote(n.id); viewModal.style.display='none'; } };
    closeView.onclick = ()=>{ viewModal.style.display='none'; };
  }

  function deleteNote(id){
    const db = readDB(); if(!db.notes[id]) return quickToast('Not found'); const title = db.notes[id].title; delete db.notes[id]; writeDB(db); quickToast('Deleted '+title); renderList(searchInput.value.trim());
  }

  function quickToast(msg){
    // tiny visual confirmation using console + title change
    console.log(msg);
  }

  // export/import
  function exportDB(){
    const db = readDB(); const blob = new Blob([JSON.stringify(db,null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href=url; a.download = `osmium-export-${new Date().toISOString().replace(/[:.]/g,'')}.json`; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  }
  function importFileHandler(file){
    if(!file) return;
    const r = new FileReader(); r.onload = ()=>{
      try{
        const incoming = JSON.parse(r.result);
        const db = readDB();
        // naive merge: import notes re-id them
        for(const note of Object.values(incoming.notes||{})){
          const id = db.nextId++;
          note.id = id;
          note.created = note.created || new Date().toISOString();
          note.updated = new Date().toISOString();
          db.notes[id] = note;
        }
        writeDB(db);
        renderList(); quickToast('Imported');
      }catch(e){ alert('Failed to import: '+e.message) }
    };
    r.readAsText(file);
  }

  // search
  searchBtn.onclick = ()=>{ renderList(searchInput.value.trim()); };
  searchInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ renderList(searchInput.value.trim()); } });

  saveBtn.onclick = saveCurrent;
  clearBtn.onclick = newNote;
  newBtn.onclick = newNote;
  exportBtn.onclick = exportDB;
  importFile.onchange = e=>{ importFileHandler(e.target.files[0]); e.target.value=''; };

  document.getElementById('copyBtn').onclick = ()=>{ navigator.clipboard.writeText(bodyInput.value||''); quickToast('copied'); };

  // initialize
  renderList();

  // optionally open a sample if none exists
  (function seed(){ const db=readDB(); if(Object.keys(db.notes).length===0){ const id = db.nextId++; db.notes[id] = { id, title:'Welcome to Osmium', body:'This is your local note/snippet manager.\n\nUse the editor to the right to create, save, search, export, and import notes. Your data is stored only in your browser localStorage under the key "'+STORAGE_KEY+'".', tags:['welcome','osmium'], created:new Date().toISOString(), updated:new Date().toISOString() }; writeDB(db); renderList(); } })();

})();
</script>
</body>
</html>
